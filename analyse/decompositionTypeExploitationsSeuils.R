rga23_mainOeuvre_Seuils <- rga23_mainOeuvre |>
  mutate(TypeExploitationsSeuils = case_when(
    indicRGA23_Cultures == 1 & indicRGA23_Elevage == 0 ~ "Respect seuil(s) Cultures",
    indicRGA23_Cultures == 0 & indicRGA23_Elevage == 1 ~ "Respect seuil(s) Elevages",
    indicRGA23_Cultures == 1 & indicRGA23_Elevage == 1 ~ "Respect seuils Cultures + Elevages",
    indicRGA23_Coprah == 1 ~ "Respect seuil Coprah"
  ))

rga23_prodVegetales_Seuils <- rga23_prodVegetales |>
  mutate(TypeExploitationsSeuils = case_when(
    indicRGA23_Cultures == 1 & indicRGA23_Elevage == 0 ~ "Respect seuil(s) Cultures",
    indicRGA23_Cultures == 0 & indicRGA23_Elevage == 1 ~ "Respect seuil(s) Elevages",
    indicRGA23_Cultures == 1 & indicRGA23_Elevage == 1 ~ "Respect seuils Cultures + Elevages",
    indicRGA23_Coprah == 1 ~ "Respect seuil Coprah"
  ))

# Nombre de coexploitants

nbCoexploitantsSeuils <- rga23_mainOeuvre_Seuils |>
  mutate(Archipel_1 = "Total Polynésie") |>
  group_by(Archipel_1, TypeExploitationsSeuils) |>
  summarize(
    nbUnites = n(),
    nbCoexploitants = sum(NbCoExploitants, na.rm = TRUE),
    moyenneCoexploitants = mean(coalesce(NbCoExploitants, 0))
  ) |>
  pivot_wider(names_from = TypeExploitationsSeuils, values_from = c(nbCoexploitants, nbUnites, moyenneCoexploitants)) |>
  select(
    Archipel_1,
    contains("Respect seuils Cultures + Elevages"),
    contains("Respect seuil(s) Elevages"),
    contains("Respect seuil(s) Cultures"),
    contains("Respect seuil Coprah")
  )

nbCoexploitantsArchipelSeuils <- rga23_mainOeuvre_Seuils |>
  group_by(Archipel_1, TypeExploitationsSeuils) |>
  summarize(
    nbUnites = n(),
    nbCoexploitants = sum(NbCoExploitants, na.rm = TRUE),
    moyenneCoexploitants = mean(coalesce(NbCoExploitants, 0))
  ) |>
  pivot_wider(names_from = TypeExploitationsSeuils, values_from = c(nbCoexploitants, nbUnites, moyenneCoexploitants)) |>
  select(
    Archipel_1,
    contains("Respect seuils Cultures + Elevages"),
    contains("Respect seuil(s) Elevages"),
    contains("Respect seuil(s) Cultures"),
    contains("Respect seuil Coprah")
  )

nbCoexploitantsArchipelSeuils <- rbind(nbCoexploitantsArchipelSeuils, nbCoexploitantsSeuils)

writeCSV(nbCoexploitantsArchipelSeuils)


## SAU

sauMoyenneSeuils <- rga23_prodVegetales_Seuils |>
  group_by(Archipel_1, TypeExploitationsSeuils) |>
  summarize(
    nbUnites = n(),
    sauMoyenne = round(mean(coalesce(SurfaceTotalProdAgri, 0)))
  ) |>
  pivot_wider(names_from = TypeExploitationsSeuils, values_from = c(nbUnites, sauMoyenne)) |>
  select(
    Archipel_1,
    contains("Respect seuils Cultures + Elevages"),
    contains("Respect seuil(s) Elevages"),
    contains("Respect seuil(s) Cultures"),
    contains("Respect seuil Coprah")
  )

sauMoyenneSeuils <- rbind(
  sauMoyenneSeuils,
  rga23_prodVegetales_Seuils |>
    mutate(Archipel_1 = "Total Polynésie") |>
    group_by(Archipel_1, TypeExploitationsSeuils) |>
    summarize(
      nbUnites = n(),
      sauMoyenne = round(mean(coalesce(SurfaceTotalProdAgri, 0)))
    ) |>
    pivot_wider(names_from = TypeExploitationsSeuils, values_from = c(nbUnites, sauMoyenne)) |>
    select(
      Archipel_1,
      contains("Respect seuils Cultures + Elevages"),
      contains("Respect seuil(s) Elevages"),
      contains("Respect seuil(s) Cultures"),
      contains("Respect seuil Coprah")
    )
)
writeCSV(sauMoyenneSeuils)

