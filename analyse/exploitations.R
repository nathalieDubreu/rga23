# Profil des exploitations par archipel (cultures, elevage, coprah)
profilExploitationsParArchipel <- rga23_champ |>
  group_by(Archipel) |>
  summarize(
    `Respect seuil Cultures` = sum(CultureValideRGA, na.rm = TRUE),
    `Respect seuil Elevage` = sum(ElevageValideRGA, na.rm = TRUE),
    `Respect seuil Coprah` = sum(CoprahValideRGA, na.rm = TRUE)
  )

totalExploitationsCultures <- sum(profilExploitationsParArchipel$`Respect seuil Cultures`, na.rm = TRUE)
totalExploitationsElevage <- sum(profilExploitationsParArchipel$`Respect seuil Elevage`, na.rm = TRUE)
totalCoprahValideRGA <- sum(profilExploitationsParArchipel$`Respect seuil Coprah`, na.rm = TRUE)

profilExploitationsParArchipelEtTotal <- profilExploitationsParArchipel |>
  add_row(
    Archipel = "Total",
    `Respect seuil Cultures` = totalExploitationsCultures,
    `Respect seuil Elevage` = totalExploitationsElevage,
    `Respect seuil Coprah` = totalCoprahValideRGA
  )

## Utilisation produits phyto
produitsPhyto <- rga23_exploitations |>
  filter(eligibilite == 1) |>
  mutate(`Utilisation produits phyto` = case_when(
    UtilisationPhytosanit == 1 ~ "Oui",
    UtilisationPhytosanit == 2 ~ "Non"
  )) |>
  group_by(`Utilisation produits phyto`) |>
  summarise(n = n()) |>
  mutate(`En %` = round((n / sum(n) * 100), 2)) |>
  select(!n)

typeProduitsPhyto <- rga23_exploitations |>
  filter(UtilisationPhytosanit == 1) |>
  mutate(`Type produits phyto` = case_when(
    TypePhytosanit__1 == 1 & TypePhytosanit__2 == 1 ~ "Synthétique + Biologique",
    TypePhytosanit__1 == 1 ~ "Synthétique (chimique)",
    TypePhytosanit__2 == 1 ~ "Biologique"
  )) |>
  group_by(`Type produits phyto`) |>
  summarise(n = n()) |>
  mutate(`En %` = round((n / sum(n) * 100), 1)) |>
  select(!n)

## Utilisation engrais
engrais <- rga23_exploitations |>
  filter(RaisonsRecensement__1 == 1 & eligibilite == 1) |>
  mutate(`Utilisation engrais` = case_when(
    UtilisationEngrais == 1 ~ "Oui",
    UtilisationEngrais == 2 ~ "Non"
  )) |>
  group_by(`Utilisation engrais`) |>
  summarise(n = n()) |>
  mutate(`En %` = round((n / sum(n) * 100), 2)) |>
  select(!n)

### Bio ?
exploitationsBio <- rga23_exploitations |>
  mutate(`Bio ?` = case_when(
    AgriBio == 1 ~ "Oui en totalité",
    AgriBio == 2 ~ "Non",
    AgriBio == 3 ~ "Oui en partie"
  ))|>
  group_by(`Bio ?`) |>
  count()
