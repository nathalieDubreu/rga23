# Profil des exploitations par archipel (cultures, elevage, coprah)
profilExploitationsParArchipel <- rga23_champ |>
  group_by(Archipel_1) |>
  summarize(
    `Respect seuil Cultures` = sum(indicRGA23_Cultures, na.rm = TRUE),
    `Respect seuil Elevage` = sum(indicRGA23_Elevage, na.rm = TRUE),
    `Respect seuil Coprah` = sum(indicRGA23_Coprah, na.rm = TRUE)
  )

totalExploitationsCultures <- sum(profilExploitationsParArchipel$`Respect seuil Cultures`, na.rm = TRUE)
totalExploitationsElevage <- sum(profilExploitationsParArchipel$`Respect seuil Elevage`, na.rm = TRUE)
totalCoprahValideRGA <- sum(profilExploitationsParArchipel$`Respect seuil Coprah`, na.rm = TRUE)

profilExploitationsParArchipelEtTotal <- profilExploitationsParArchipel |>
  add_row(
    Archipel_1 = "Total",
    `Respect seuil Cultures` = totalExploitationsCultures,
    `Respect seuil Elevage` = totalExploitationsElevage,
    `Respect seuil Coprah` = totalCoprahValideRGA
  )

## Utilisation produits phyto
produitsPhyto <- rga23_exploitations |>
  filter(eligibilite == 1) |>
  mutate(`Utilisation produits phyto` = case_when(
    UtilisationPhytosanit == 1 ~ "Oui",
    UtilisationPhytosanit == 2 ~ "Non"
  )) |>
  group_by(`Utilisation produits phyto`) |>
  summarise(count = n()) |>
  mutate(`Part des exploitants` = round(count / sum(count) * 100, 1))

surfaceAvecProduitsPhyyo <- inner_join(rga23_exploitations |> filter(UtilisationPhytosanit == 1),
  rga23_surfacesCultures |> filter(culture_id != 701 & culture_id != 702 & culture_id != 705 & culture_id != 307 & culture_id != 308 & culture_id != 309),
  by = "interview__key"
) |> summarize(sum(SurfaceCult, rm.na = TRUE) / 10000)
writeCSV(surfaceAvecProduitsPhyyo)

## par Archipel
produitsPhytoArchipel <- rga23_exploitations |>
  filter(eligibilite == 1) |>
  mutate(`Utilisation produits phyto` = case_when(
    UtilisationPhytosanit == 1 ~ "Oui",
    UtilisationPhytosanit == 2 ~ "Non"
  )) |>
  groupByTotalEtPourcent(Archipel_1, `Utilisation produits phyto`)

typeProduitsPhyto <- rga23_exploitations |>
  filter(UtilisationPhytosanit == 1) |>
  mutate(`Type produits phyto` = case_when(
    TypePhytosanit__1 == 1 & TypePhytosanit__2 == 1 ~ "Synthétique + Biologique",
    TypePhytosanit__1 == 1 ~ "Synthétique (chimique)",
    TypePhytosanit__2 == 1 ~ "Biologique"
  )) |>
  group_by(`Type produits phyto`) |>
  calculPourcentage()

## Utilisation engrais
engrais <- rga23_exploitations |>
  filter(RaisonsRecensement__1 == 1 & eligibilite == 1) |>
  mutate(`Utilisation engrais` = case_when(
    UtilisationEngrais == 1 ~ "Oui",
    UtilisationEngrais == 2 ~ "Non"
  )) |>
  groupByTotalEtPourcent(Archipel_1, `Utilisation engrais`)


# Engrais (ou amendements) de synthèse............1
# Engrais (ou amendements) organiques.............2
# Engrais (ou amendements) minéraux biologiques...3

typeEngrais <- rga23_exploitations |>
  filter(UtilisationEngrais == 1) |>
  mutate(`Type engrais` = case_when(
    TypeEngrais__1 == 1 & TypeEngrais__2 == 0 & TypeEngrais__3 == 0 ~ "Engrais (ou amendements) de synthèse - uniquement",
    TypeEngrais__1 == 0 & TypeEngrais__2 == 1 & TypeEngrais__3 == 0 ~ "Engrais (ou amendements) organiques - uniquement",
    TypeEngrais__1 == 0 & TypeEngrais__2 == 0 & TypeEngrais__3 == 1 ~ "Engrais (ou amendements) minéraux biologiques - uniquement",
    TypeEngrais__1 == 1 | TypeEngrais__2 == 1 | TypeEngrais__3 == 1 ~ "Différents types d'engrais",
    TRUE ~ "?!?"
  )) |>
  group_by(`Type engrais`) |>
  calculPourcentage()

### Bio ?
exploitationsBio <- rga23_exploitations |>
  filter(eligibilite == 1) |>
  mutate(`Bio ?` = case_when(
    AgriBio == 1 ~ "Oui en totalité",
    AgriBio == 2 ~ "Non",
    AgriBio == 3 ~ "Oui en partie"
  )) |>
  group_by(`Bio ?`) |>
  count()
